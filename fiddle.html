<!DOCTYPE html>
<html>
<head>
  <title>Audio Chroma</title>
  <audio src="Final_Fantasy_6_Magicite_Made_My_Mind_Melt_OC_ReMix.mp3" id="audio" controls>Audio not supported</audio>
</head>
<body>
<canvas id="canas-stuff" width="800" height="350">
  
</canvas>
<script>

var audioCtx = new (window.AudioContext || window.webkitAudioContexxt) ();
var analyser = audioCtx.createAnalyser();
source = audioCtx.createMediaStreamSource(stream);
source.connect(analyser);
analyser.connect(distortion);
distortion.connect(audioCtx.destination);

analyser.fftSize = 256;
var bufferLength = analyser.frequencyBinCount;
console.log(bufferLength);
var dataArray = new Uint8Array(bufferLength);
//clear current canvas display
canvasCtx.clearRect(0, 0, WIDTH, HEIGHT);

function draw() {
	drawVisual = requestAnimationFrame(draw);
	analyser.getByteFrequencyData(dataArray);
  canvasCtx.fillStyle = 'rgb(0, 0, 0)';
  //reset the frame for the next bar height update
  canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);
}
var barWidth = (WIDTH / bufferLength) * 2.5;
var barHeight;
//height of canvas html element
var HEIGHT = 350;
//x records how far accross the screen to draw the current bar
var x = 0;
for(var i = 0; i < bufferLength; i++) {
	barHeight = dataArray[i]/2;
  canvasCtx.fillStyle = 'rgb(' + (barHeight+100) + ',50,50)';
  //HEIGHT lets the bars come up from the bottom and not down from the bottom
  canvasCtx.fillRect(x,HEIGHT-barHeight/2,barWidth,barHeight);
   x += barWidth + 1;
  }
};
draw();
</script>
</body>
</html>
